#!/bin/bash

hdf5_file="channel_cont_20190913_66396_0.hdf5"
if [[ -n "$1" && "$1" != "-" ]]; then
   hdf5_file="$1"
fi

out_file=${hdf5_file%%.hdf5}_power_vs_nant.txt

calsol="-28.68,0.00,0.00,2.35,-22.27,8.80,-37.61,20.16,59.93,26.44,0.10,-61.40,14.32,-42.96,6.48,-6.88,12.21,17.35,0.00,-33.12,24.90,32.91,-24.64,-44.98,-30.93,0.51,-19.39,-15.50,-8.82,38.48,10.25,0.00,14.16,-23.88,-31.35,21.43,-54.84,-23.73,-26.83,-56.53,7.29,11.91,-3.28,-19.85,-59.50,-3.11,-14.77,-37.12,-22.24,-44.87,49.24,28.84,14.85,-42.94,-30.08,19.06,4.67,-76.98,-35.08,-79.75,3.71,-73.45,-56.42,-41.88,13.98,-19.02,-4.36,-12.82,-3.85,4.54,26.47,-29.55,-61.14,18.24,4.24,14.76,-15.83,4.67,0.18,-10.74,29.87,0.00,-40.36,-123.73,-82.94,-63.98,0.00,-79.78,-92.29,-0.00,25.84,-67.05,28.57,-27.64,-46.56,31.36,65.02,42.06,-89.87,-6.74,-38.34,-23.94,0.61,39.59,17.08,-13.11,24.40,1.97,-11.13,50.08,11.41,20.99,30.02,-53.75,-55.21,0.11,40.53,-2.41,39.81,-29.89,-34.80,28.57,-10.75,-14.56,36.44,-6.84,60.96,-3.12,4.16,11.71,-42.23,20.03,14.42,-26.28,-46.67,-48.25,0.00,17.51,-44.75,-14.97,18.50,0.00,-24.62,-16.32,2.13,-27.73,27.62,27.76,2.92,-23.76,-21.71,-9.99,39.56,-49.95,-36.75,-73.12,19.48,54.19,0.00,12.72,-40.21,-34.20,-35.79,31.44,2.45,-11.40,38.46,-33.14,-86.46,10.23,-29.37,-52.35,-30.34,-114.98,-0.87,22.37,-49.37,-36.97,-20.91,-22.60,33.06,21.64,4.79,59.31,-32.67,48.50,-43.77,15.22,-10.70,-88.06,68.07,31.82,0.00,-63.12,98.42,-56.45,-78.90,149.23,-121.40,-74.58,-142.43,162.88,-148.40,68.07,101.74,165.08,-148.28,-76.99,-47.68,47.69,0.00,36.14,37.09,-11.72,40.66,15.29,6.79,-73.89,-178.49,29.62,73.06,0.00,-59.65,-93.47,-22.26,-4.71,-32.44,-104.23,-70.40,26.58,7.13,-48.87,-20.59,0.00,-45.59,14.28,36.70,-20.79,-22.15,18.48,-39.39,30.09,-20.45,34.78,-0.88,59.03,40.37,-23.07,41.26,-8.64,-21.20,-8.87,0.00,-23.14,-21.94,28.54"

rm -f  ${out_file}

ant=1
while [[ $ant -le 256 ]];
do
   echo "hdf5_correlator $hdf5_file -B -o ${out_file} -f -c 1 -C 1 -X ${calsol} -A ${ant}"
   hdf5_correlator $hdf5_file -B -o ${out_file} -f -c 1 -C 1 -X ${calsol} -A ${ant}
   
   ant=$(($ant+1))   
done

awk '{print $7" "$5;}'  ${out_file} > power_vs_nant.txt
awk '{print $7" "$3;}'  ${out_file} > power_vs_nant2.txt

mkdir -p images/
root -b -l "plot_power_vs_nant.C(\"power_vs_nant.txt\")"
root -b -l "plot_power_vs_nant.C(\"power_vs_nant2.txt\")"
cd images/
gthumb -n *png &




